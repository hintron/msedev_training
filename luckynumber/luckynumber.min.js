//
//// Display Code
//

document.addEventListener("DOMContentLoaded", function(event) {
    document.querySelector("#generate-btn").addEventListener("click", output_lucky_number);
    console.time("generate_lut");
    generate_lut();
    console.timeEnd("generate_lut");
});

// function output_lucky_number_wrapper() {
//     console.time("from_button_click");
//     output_lucky_number()
//     console.timeEnd("from_button_click");
// }

function output_lucky_number() {
    var user_input = document.querySelector('#user_input').value;

    // Make sure input isn't null
    if(user_input == ""){
        document.querySelector('#lucky_number').textContent = "Input was null...";
        return;
    }

    // convert input into a number
    user_input = +user_input;
    if(!Number.isInteger(user_input)){
        document.querySelector('#lucky_number').textContent = "Input was not an integer...";
    }

    // Bounds checking
    if(user_input > 777777777) {
        document.querySelector('#lucky_number').textContent = "Input was too big. Must be a 32-bit 2's compliment number";
        return;
    }

    // Calculate the lucky number
    console.time("get_lucky_number");
    lucky_number = get_lucky_number(user_input);
    console.timeEnd("get_lucky_number");

    // Output the lucky number
    if(lucky_number){
        document.querySelector('#lucky_number').textContent = lucky_number;
    }
    else {
        document.querySelector('#lucky_number').textContent = "Could not find the lucky number...";
    }
}




//
//// Lucky Number code
//
const MAX_DIGITS = 9;
var lut = [];
var masks = [];
function generate_lut() {
    for (var i = 0; i < MAX_DIGITS; i++) {
        var num = 1 << i;
        masks.push(num);
    }
    for (var digit_number = 1; digit_number <= MAX_DIGITS; digit_number++) {
        var generate_count = 1 << (digit_number);
        for (var i = 0; i < generate_count; i++) {
            var strArray = [];
            for(var j = 0; j < digit_number; j++){
                strArray[j] = ((masks[j] & i)) ? "7" : "4";
            }
            var str = "";
            for (var k = strArray.length-1; k >= 0; k--) {
                str += strArray[k];
            }
            lut.push(~~str);
        }
    }
}
function get_lucky_number(input){
    for (var i = 0; i < lut.length; i++) {
        if(input <= lut[i]){
            return lut[i];
        }
    }
}




